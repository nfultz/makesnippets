#!/usr/bin/make -f

SHELL := /bin/bash
.SHELLFLAGS = -e
.ONESHELL:
.DEFAULT_GOAL := help
.OUTER_MAKEFILE := $(firstword $(MAKEFILE_LIST))
.TARGETS  := $(shell grep -ho '^[a-z]*' $(.OUTER_MAKEFILE) | xargs echo)
.PHONY : $(.TARGETS)

# adapted from https://marmelab.com/blog/2016/02/29/auto-documented-makefile.html
help : ## Prints this message
	@echo Snippet Manager by nfultz
	@echo ----------------------------------------
	@sed -n '/^[a-z]/ s/:.*## */_/ p' $(MAKEFILE_LIST) | column -t -s _

edit : ## Open the snippet file in $EDITOR
	@$$EDITOR $(.OUTER_MAKEFILE)

completion : ## Prints out a bash completion command to eval
	@echo complete -W "'$(.TARGETS)'" $(notdir $(.OUTER_MAKEFILE))

fzf : ## Choose a snippet and run it.
	@printf '%s\n' $(.TARGETS) | fzf | xargs $(MAKE) -s -f $(.OUTER_MAKEFILE)

install :
	install $(.OUTER_MAKEFILE) /usr/local/include
